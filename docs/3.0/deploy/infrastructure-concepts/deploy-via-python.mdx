mdxtitleDeployflowswithPythondescriptionLearnhowtousethePythonSDKtodeployflowstoruninworkpoolsPrefectoffersaflexiblewaytodeployflowstodynamicinfrastructureusingthePythonSDKThisapproachallowsyoutotargetspecificworkpoolsandutilizedynamicallyprovisionedinfrastructureDeployingflowstodynamicinfrastructureoffersaflexibleandprogrammaticapproachtomanagingyourPrefectworkflowsWhileflowserveremainsavalidandstraightforwardmethodfordeployingflowstopersistentinfrastructuretherearescenarioswhereyoumightneedtoleveragedynamicscalableresourcesInthesecasesflowdeployprovidesapowerfulalternativethatallowsyoutotargetspecificworkpoolsandutilizedynamicallyprovisionedinfrastructureWhentoconsiderflowdeployoverflowserveTheflowservemethodisanexcellentchoiceformanyusecasesespeciallywhenyouhavereadilyavailablepersistentinfrastructureHoweveryoumightwanttoconsiderusingflowdeployinthefollowingsituations1CostoptimizationDynamicinfrastructurecanhelpreducecostsbyscalingresourcesupordownbasedondemand2ResourcescarcityIfyouhavelimitedpersistentinfrastructuredynamicprovisioningcanhelpmanageresourceallocationmoreefficiently3VaryingworkloadsForworkflowswithinconsistentresourceneedsdynamicinfrastructurecanadapttochangingrequirements4CloudnativedeploymentsWhenworkingwithcloudprovidersthatofferserverlessorautoscalingoptionsByusingflowdeployyoucantakeadvantageofPrefectsworkpoolsystemwhichprovidesalayerofabstractionbetweenyourflowsandtheunderlyinginfrastructureThisapproachoffersgreaterflexibilityandefficiencyinrunningyourworkflowswhendynamicinfrastructureisneededLetsexplorehowtocreateadeploymentusingthePythonSDKandleveragedynamicinfrastructurethroughworkpoolsPrerequisitesBeforedeployingyourflowusingflowdeployensureyouhavethefollowing1ArunningPrefectserverorPrefectCloudworkspaceYoucaneitherrunaPrefectserverlocallyoruseaPrefectCloudworkspaceTostartalocalserverrunprefectserverstartTousePrefectCloudsignupforanaccountatappprefectcloudhttpsappprefectcloudandfollowtheConnecttoPrefectCloud30managecloudconnecttocloudguide2APrefectflowYoushouldhaveaflowdefinedinyourPythonscriptIfyouhaventcreatedaflowyetrefertotheWriteFlows30developwriteflowsguide3AworkpoolYouneedaworkpooltomanagetheinfrastructureforrunningyourflowIfyouhaventcreatedaworkpoolyoucandosothroughthePrefectUIorusingthePrefectCLIFormoreinformationseetheWorkPools30deployinfrastructureconceptsworkpoolsguideForexamplesinthisguidewelluseaDockerworkpoolcreatedbyrunningbashprefectworkpoolcreatetypedockermyworkpool4DockerDockerwillbeusedtobuildandstoretheimagecontainingyourflowcodeYoucandownloadandinstallDockerfromtheofficialDockerwebsitehttpswwwdockercomgetstartedIfyoudontwanttouseDockeryoucanseeotheroptionsintheUseremotecodestorageuseremotecodestoragesection5OptionalADockerregistryaccountWhilenotstrictlynecessaryforlocaldevelopmenthavinganaccountwithaDockerregistrysuchasDockerHubisrecommendedforstoringandsharingyourDockerimagesWiththeseprerequisitesinplaceyourereadytodeployyourflowusingflowdeployDeployaflowwithflowdeployTodeployaflowusingflowdeployandDockerfollowthesestepsStepsSteptitleWriteaflowEnsureyourflowisdefinedinaPythonfileLetsuseasimpleexamplepythonexamplepyfromprefectimportflowflowlog_printsTruedefmy_flownamestrworldprintfHellonameStepSteptitleAdddeploymentconfigurationAddacalltoflowdeploytotellPrefecthowtodeployyourflowpythonexamplepyfromprefectimportflowflowlog_printsTruedefmy_flownamestrworldprintfHellonameif__name____main__my_flowdeploynamemydeploymentwork_pool_namemyworkpoolimagemydockerimagedevpushFalseStepSteptitleDeployRunyourscripttodeployyourflowbashpythonexamplepyRunningthisscriptwill1BuildaDockerimagecontainingyourflowcodeanddependencies2CreateadeploymentassociatedwiththespecifiedworkpoolandimageStepStepsBuildingaDockerimageforourflowallowsustohaveaconsistentenvironmentforourflowtoruninWorkersforourworkpoolwillusetheimagetorunourflowInthisexamplewesetpushFalsetoskippushingtheimagetoaregistryThisisusefulforlocaldevelopmentandyoucanpushyourimagetoaregistrysuchasDockerHubinaproductionenvironmentNoteWherestheDockerfileIntheaboveexamplewedidntspecifyaDockerfileBydefaultPrefectwillgenerateaDockerfileforusthatcopiestheflowcodeintoanimageandinstallsanyadditionaldependenciesIfyouwanttowriteanduseyourownDockerfileyoucandosobypassingadockerfileparametertoflowdeployNoteTriggerarunNowthatwehaveourflowdeployedwecantriggerarunviaeitherthePrefectCLIorUIFirstweneedtostartaworkertorunourflowIftherearenoactiveworkersintheworkpoolyoucanstartonewiththefollowingcommandbashprefectworkerstartpoolmyworkpoolThenwecantriggerarunofourflowusingthePrefectCLIbashprefectdeploymentrunmyflowmydeploymentAfterafewsecondsyoushouldseelogsfromyourworkershowingthattheflowrunhasstartedandseethestateupdateintheUIDeploywithascheduleTodeployaflowwithascheduleyoucanuseoneofthefollowingoptionsintervalDefinestheintervalatwhichtheflowshouldrunAcceptsanintegerorfloatvaluerepresentingthenumberofsecondsbetweenrunsoradatetimetimedeltaobjectExpandabletitleExamplepythonintervalpyfromdatetimeimporttimedeltafromprefectimportflowflowlog_printsTruedefmy_flownamestrworldprintfHellonameif__name____main__my_flowdeploynamemydeploymentwork_pool_namemyworkpoolimagemydockerimagedevpushFalseRunonceaminuteintervaltimedeltaminutes1ExpandablecronDefineswhenaflowshouldrunusingacronstringExpandabletitleExamplepythoncronpyfromprefectimportflowflowlog_printsTruedefmy_flownamestrworldprintfHellonameif__name____main__my_flowdeploynamemydeploymentwork_pool_namemyworkpoolimagemydockerimagedevpushFalseRunonceadayatmidnightcron00ExpandablerruleDefinesacomplexscheduleusinganrrulestringExpandabletitleExamplepythonrrulepyfromprefectimportflowflowlog_printsTruedefmy_flownamestrworldprintfHellonameif__name____main__my_flowdeploynamemydeploymentwork_pool_namemyworkpoolimagemydockerimagedevpushFalseRuneveryweekdayat9AMrruleFREQWEEKLYBYDAYMOTUWETHFRBYHOUR9BYMINUTE0ExpandableschedulesDefinesmultipleschedulesforadeploymentThisoptionprovidesflexibilityforSettingupvariousrecurringschedulesImplementingcomplexschedulinglogicApplyingtimezoneoffsetstoschedulesExpandabletitleExamplepythonschedulespyfromdatetimeimportdatetimetimedeltafromprefectimportflowfromprefectclientschemasschedulesimportIntervalScheduleflowlog_printsTruedefmy_flownamestrworldprintfHellonameif__name____main__my_flowdeploynamemydeploymentwork_pool_namemyworkpoolimagemydockerimagedevpushFalseRunevery10minutesstartingfromJanuary12023at0000CentralTimeschedulesIntervalScheduleintervaltimedeltaminutes10anchor_datedatetime20231100timezoneAmericaChicagoExpandableLearnmoreaboutscheduleshere30automateaddschedulesUseremotecodestorageInadditiontostoringyourcodeinaDockerimagePrefectalsosupportsdeployingyourcodetoremotestorageThisapproachallowsyoutostoreyourflowcodeinaremotelocationsuchasaGitrepositoryorcloudstorageserviceUsingremotestorageforyourcodehasseveraladvantages1FasteriterationsYoucanupdateyourflowcodewithoutrebuildingDockerimages2ReducedstoragerequirementsYoudontneedtostorelargeDockerimagesforeachcodeversion3FlexibilityYoucanusedifferentstoragebackendsbasedonyourneedsandinfrastructureUsinganexistingremoteGitrepositorylikeGitHubGitLaborBitbucketworksreallywellasremotecodestoragebecause1Yourcodeisalreadythere2Youcandeploytomultipleenvironmentsviabranchesandtags3YoucanrollbacktopreviousversionsofyourflowsTodeployusingremotestorageyoullneedtospecifywhereyourcodeisstoredbyusingflowfrom_sourcetofirstloadyourflowcodefromaremotelocationHeresanexampleofloadingaflowfromaGitrepositoryanddeployingitpythongitdeploypyfromprefectimportflowif__name____main__flowfrom_sourcesourcehttpsgithubcomusernamerepositorygitentrypointpathtoyourflowpyyour_flow_functiondeploynamemydeploymentwork_pool_namemyworkpoolThesourceparametercanacceptavarietyofremotestorageoptionsincludingGitrepositoriesS3bucketsusingthes3schemeGoogleCloudStoragebucketsusingthegsschemeAzureBlobStorageusingtheazschemeTheentrypointparameteristhepathtotheflowfunctionwithinyourrepositorycombinedwiththenameoftheflowfunctionLearnmoreaboutremotecodestoragehere30deployinfrastructureconceptsstoreflowcodeSetdefaultparametersYoucansetdefaultparametersforadeploymentusingtheparameterskeywordargumentinflowdeploypythondefaultparameterspyfromprefectimportflowflowdefmy_flownamestrworldprintfHellonameif__name____main__my_flowdeploynamemydeploymentwork_pool_namemyworkpoolWillprintHelloMarvinbydefaultinsteadofHelloworldparametersnameMarvinimagemydockerimagedevpushFalseNotetheseparameterscanstillbeoverriddenonaperdeploymentbasisSetjobvariablesYoucansetdefaultjobvariablesforadeploymentusingthejob_variableskeywordargumentinflowdeployThejobvariablesprovidedwilloverridethevaluessetontheworkpoolpythonjobvariablespyimportosfromprefectimportflowflowdefmy_flownameosgetenvNAMEworldprintfHellonameif__name____main__my_flowdeploynamemydeploymentwork_pool_namemyworkpoolWillprintHelloMarvinbydefaultinsteadofHelloworldjob_variablesenvNAMEMarvinimagemydockerimagedevpushFalseJobvariablescanbeusedtocustomizeenvironmentvariablesresourceslimitsandotherinfrastructureoptionsallowingfinegrainedcontroloveryourinfrastructureonaperdeploymentorperflowrunbasisAnyvariabledefinedinthebasejobtemplateoftheassociatedworkpoolcanbeoverriddenbyajobvariableYoucanlearnmoreaboutjobvariableshere30deployinfrastructureconceptscustomizeDeploymultipleflowsTodeploymultipleflowsatonceusethedeployfunctionpythonmultideploypyfromprefectimportflowdeployflowdefmy_flow_1printImnumberoneflowdefmy_flow_2printAlwayssecondif__name____main__deployUsetheto_deploymentmethodtospecifyconfigurationspecifictoeachdeploymentmy_flow_1to_deploymentmydeployment1my_flow_2to_deploymentmydeployment2SpecifysharedconfigurationforbothdeploymentsimagemydockerimagedevpushFalsework_pool_namemyworkpoolWhenweruntheabovescriptitwillbuildasingleDockerimageforbothdeploymentsThisapproachoffersthefollowingbenefitsSavestimeandresourcesbyavoidingredundantimagebuildsSimplifiesmanagementbymaintainingasingleimageformultipleflowsAdditionalresourcesWorkPools30deployinfrastructureconceptsworkpoolsStoreFlowCode30deployinfrastructureconceptsstoreflowcodeCustomizeInfrastructure30deployinfrastructureconceptscustomizeSchedules30automateaddschedulesWriteFlows30developwriteflows