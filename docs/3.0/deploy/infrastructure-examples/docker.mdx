mdxtitleRunflowsinDockercontainersdescriptionLearnhowtodeployaflowtoaDockerworkpoolwithworkersInthisexampleyouwillsetupaDockerworkpool30deployinfrastructureconceptsworkpoolsstorestheinfrastructureconfigurationforyourdeploymentaDockerworker30deployinfrastructureconceptsworkersprocessthatpollsthePrefectAPIforflowrunstoexecuteasDockercontainersadeployment30deployindexaflowthatshouldrunaccordingtotheconfigurationonyourDockerworkpoolThenyoucanexecuteyourdeploymentviathePrefectAPIthroughtheSDKCLIUIetcYoumusthaveDockerhttpsdocsdockercomengineinstallinstalledandrunningonyourmachineNoteExecutingflowsinalonglivedcontainerThisguideshowshowtorunaflowinanephemeralcontainerthatisremovedaftertheflowruncompletesToinsteadlearnhowtorunflowsinastaticlonglivedcontainerseethis30deploystaticinfrastructureexamplesdockerguideNoteCreateaworkpoolAworkpoolprovidesdefaultinfrastructureconfigurationsthatalljobsinheritandcanoverrideYoucanadjustmanydefaultssuchasthebaseDockerimagecontainercleanupbehaviorandresourcelimitsTosetupaDockertypeworkpoolwiththedefaultvaluesrunbashprefectworkpoolcreatetypedockermydockerpoolorcreatetheworkpoolintheUIToconfirmtheworkpoolcreationwassuccessfulrunbashprefectworkpoollsYoushouldseeyournewmydockerpoollistedintheoutputNextcheckthatyoucanseethisworkpoolinyourPrefectUINavigatetotheWorkPoolstabandverifythatyouseemydockerpoollistedWhenyouclickintomydockerpoolyoushouldseearedstatusiconsignifyingthatthisworkpoolisnotreadyTomaketheworkpoolreadyyoullneedtostartaworkerWellshowhowtodothisnextStartaworkerWorkersarealightweightpollingprocessthatkickoffscheduledflowrunsonaspecifictypeofinfrastructuresuchasDockerTostartaworkeronyourlocalmachineopenanewterminalandconfirmthatyourvirtualenvironmenthasprefectinstalledRunthefollowingcommandinthisnewterminaltostarttheworkerbashprefectworkerstartpoolmydockerpoolYoushouldseetheworkerstartItsnowpollingthePrefectAPItocheckforanyscheduledflowrunsitshouldpickupandthensubmitforexecutionYoullseeyournewworkerlistedintheUIundertheWorkerstaboftheWorkPoolspagewitharecentlastpolleddateTheworkpoolshouldhaveaReadystatusindicatorTipProTipIfmydockerpooldoesnotalreadyexistthebelowcommandwillcreateitforyouautomaticallywiththedefaultsettingsforthatworkpooltypeinthiscasedockerbashprefectworkerstartpoolmydockerpooltypedockerTipKeepthisterminalsessionactivefortheworkertocontinuetopickupjobsSinceyouarerunningthisworkerlocallytheworkerwillifyouclosetheterminalInaproductionsettingthisworkershouldrunasadaemonizedormanagedprocess30resourcesdaemonizeprocessesCreatethedeploymentFromthepreviousstepsyounowhaveAworkpoolAworkerNextyoullcreateadeploymentfromyourflowcodeAutomaticallybakeyourcodeintoaDockerimageCreateadeploymentfromPythoncodebycallingthedeploymethodonaflowpythondeploy_buypyfromprefectimportflowflowlog_printsTruedefbuyprintBuyingsecuritiesif__name____main__buydeploynamemycodebakedintoanimagedeploymentwork_pool_namemydockerpoolimagemy_registrymy_imagemy_image_tagNowrunthescripttocreateadeploymentinfutureexamplesthisstepisomittedforbrevitybashpythondeploy_buypyYoushouldseemessagesinyourterminalthatDockerisbuildingyourimageWhenthedeploymentbuildsucceedsyouwillseeinformationinyourterminalshowingyouhowtostartaworkerforyourdeploymentandhowtorunyourdeploymentYourdeploymentisvisibleontheDeploymentspageintheUIBydefaultdeploybuildsaDockerimagewithyourflowcodebakedintoitandpushestheimagetotheDockerHubhttpshubdockercomregistryspecifiedintheimageargumentNoteAuthenticationtoDockerHubYourenvironmentmustbeauthenticatedtoyourDockerregistrytopushanimagetoitNoteYoucanspecifyaregistryotherthanDockerHubbyprovidingthefullregistrypathintheimageargumentWarningIfbuildingaDockerimageyourenvironmentwithyourdeploymentneedsDockerinstalledandrunningWarningToavoidpushingtoaregistrysetpushFalseinthedeploymethodpythonif__name____main__buydeploynamemycodebakedintoanimagedeploymentwork_pool_namemydockerpoolimagemy_registrymy_imagemy_image_tagpushFalseToavoidbuildinganimagesetbuildFalseinthedeploymethodpythonif__name____main__buydeploynamemycodebakedintoanimagedeploymentwork_pool_namemydockerpoolimagemy_registryalreadybuiltimage10buildFalseThespecifiedimagemustbeavailableinyourdeploymentsexecutionenvironmentforaccessibleflowcodePrefectgeneratesaDockerfileforyouthatbuildsanimagebasedoffofoneofPrefectspublishedimagesThegeneratedDockerfilecopiesthecurrentdirectoryintotheDockerimageandinstallsanydependencieslistedinarequirementstxtfileAutomaticallybuildacustomDockerimagewithalocalDockerfileIfyouwanttouseacustomDockerfilespecifythepathtotheDockerfilewiththeDockerImageclasspythoncustom_dockerfilepyfromprefectimportflowfromprefectdockerimportDockerImageflowlog_printsTruedefbuyprintSellingsecuritiesif__name____main__buydeploynamemycustomdockerfiledeploymentwork_pool_namemydockerpoolimageDockerImagenamemy_imagetagdeployguidedockerfileDockerfilepushFalseTheDockerImageobjectenablesimagecustomizationForexampleyoucaninstallaprivatePythonpackagefromGCPsartifactregistrylikethis1CreateacustombaseDockerfileFROMpython312ARGAUTHED_ARTIFACT_REG_URLCOPYrequirementstxtrequirementstxtRUNpipinstallextraindexurlAUTHED_ARTIFACT_REG_URLrrequirementstxt1CreateyourdeploymentwiththeDockerImageclasspythonprivatepackagepyfromprefectimportflowfromprefectdeploymentsrunnerimportDockerImagefromprefectblockssystemimportSecretfrommyprojectcoolimportdo_something_coolflowlog_printsTruedefmy_flowdo_something_coolif__name____main__artifact_reg_urlSecretSecretloadartifactregurlmy_flowdeploynamemydeploymentwork_pool_namemydockerpoolimageDockerImagenamemyimagetagtestdockerfileDockerfilebuildargsAUTHED_ARTIFACT_REG_URLartifact_reg_urlgetNotethatyouusedaPrefectSecretblock30developblockstoloadtheURLconfigurationfortheartifactregistryaboveSeealltheoptionalkeywordargumentsfortheDockerImageclasshttpsdockerpyreadthedocsioenstableimageshtmldockermodelsimagesImageCollectionbuildTipDefaultDockernamespaceYoucansetthePREFECT_DEFAULT_DOCKER_BUILD_NAMESPACEsettingtoappendadefaultDockernamespacetoallimagesyoubuildwithdeployThisishelpfulifyouuseaprivateregistrytostoreyourimagesTosetadefaultDockernamespaceforyourcurrentprofilerunbashprefectconfigsetPREFECT_DEFAULT_DOCKER_BUILD_NAMESPACEdockerregistryurlorganizationorusernameOncesetyoucanomitthenamespacefromyourimagenamewhencreatingadeploymentpythonwith_default_docker_namespacepyif__name____main__buydeploynamemycodebakedintoanimagedeploymentwork_pool_namemydockerpoolimagemy_imagemy_image_tagTheabovecodebuildsanimagewiththeformatdockerregistryurlorganizationorusernamemy_imagemy_image_tagwhenPREFECT_DEFAULT_DOCKER_BUILD_NAMESPACEissetTipStoreyourcodeingitbasedcloudstorageWhilebakingcodeintoDockerimagesisapopulardeploymentoptionmanyteamsstoretheirworkflowcodeingitbasedstoragesuchasGitHubBitbucketorGitLabIfyoudontspecifyanimageargumentfordeployyoumustspecifywheretopulltheflowcodefromatruntimewiththefrom_sourcemethodHereshowtopullyourflowcodefromaGitHubrepositorypythongit_storagepyfromprefectimportflowif__name____main__flowfrom_sourcehttpsgithubcommy_github_accountmy_repomy_filegitentrypointflowsnoimagepyhello_worlddeploynamenoimagedeploymentwork_pool_namemydockerpoolbuildFalseTheentrypointisthepathtothefiletheflowislocatedinandthefunctionnameseparatedbyacolonSeetheStoreflowcode30deployinfrastructureconceptsstoreflowcodeguideformoreflowcodestorageoptionsAdditionalconfigurationwithdeployNextseedeploymentconfigurationoptionsTopassparameterstoyourflowyoucanusetheparametersargumentinthedeploymethodJustpassinadictionaryofkeyvaluepairspythonpass_paramspyfromprefectimportflowflowdefhello_worldnamestrprintfHellonameif__name____main__hello_worlddeploynamepassparamsdeploymentwork_pool_namemydockerpoolparametersdictnamePrefectimagemy_registrymy_imagemy_image_tagThejob_variablesparameterallowsyoutofinetunetheinfrastructuresettingsforadeploymentThevaluespassedinoverridedefaultvaluesinthespecifiedworkpoolsbasejobtemplate30deployinfrastructureconceptsworkpoolsbasejobtemplateYoucanoverrideenvironmentvariablessuchasimage_pull_policyandimageforaspecificdeploymentwiththejob_variablesargumentpythonjob_var_image_pullpyif__name____main__get_repo_infodeploynamemydeploymentneverpullwork_pool_namemydockerpooljob_variablesimage_pull_policyNeverimagemyimagemytagpushFalseSimilarlyyoucanoverridetheenvironmentvariablesspecifiedinaworkpoolthroughthejob_variablesparameterpythonjob_var_env_varspyif__name____main__get_repo_infodeploynamemydeploymentneverpullwork_pool_namemydockerpooljob_variablesenvEXTRA_PIP_PACKAGESboto3imagemyimagemytagpushFalseThedictionarykeyEXTRA_PIP_PACKAGESdenotesaspecialenvironmentvariablethatPrefectusestoinstalladditionalPythonpackagesatruntimeThisapproachisanalternativetobuildinganimagewithacustomrequirementstxtcopiedintoitSeeOverrideworkpooljobvariables30deployinfrastructureconceptscustomizeformoreinformationabouthowtocustomizethesevariablesWorkwithmultipledeploymentswithdeployCreatemultipledeploymentsfromoneormorePythonfilesthatusedeployYoucanmanagethesedeploymentsindependentlyofoneanothertodeploythesameflowwithdifferentconfigurationsinthesamecodebaseTocreatemultipleworkpoolbaseddeploymentsatonceusethedeployfunctionwhichisanalogoustotheservefunctionpythonfromprefectimportdeployflowflowlog_printsTruedefbuyprintBuyingsecuritiesif__name____main__deploybuyto_deploymentnamedevdeploywork_pool_namemydockerpoolbuyto_deploymentnameproddeploywork_pool_namemydockerpoolimagemyregistrymyimagedevpushFalseIntheexampleaboveyoucreatedtwodeploymentsfromthesameflowbutwithdifferentworkpoolsAlternativelyyoucancreatetwodeploymentsfromdifferentflowspythonfromprefectimportdeployflowflowlog_printsTruedefbuyprintBuyingsecuritiesflowlog_printsTruedefsellprintSellingsecuritiesif__name____main__deploybuyto_deploymentnamebuydeploysellto_deploymentnameselldeploywork_pool_namemydockerpoolimagemyregistrymyimagedevpushFalseIntheexampleabovethecodeforbothflowsisbakedintothesameimageYoucanspecifyoneormoreflowstopullfromaremotelocationatruntimewiththefrom_sourcemethodHeresanexampleofdeployingtwoflowsonedefinedlocallyandonedefinedinaremoterepositorypythonfromprefectimportdeployflowflowlog_printsTruedeflocal_flowprintImaflowif__name____main__deploylocal_flowto_deploymentnameexampledeploylocalflowflowfrom_sourcesourcehttpsgithubcomorgrepogitentrypointflowspymy_flowto_deploymentnameexampledeployremoteflowwork_pool_namemydockerpoolimagemyregistrymyimagedevYoucanpassanynumberofflowstothedeployfunctionThisisusefulifusingamonorepoapproachtoyourworkflowsLearnmoreDeployflowsonKubernetes30deployinfrastructureexampleskubernetesDeployflowsonserverlessinfrastructure30deployinfrastructureexamplesserverlessDaemonizeworkers30resourcesdaemonizeprocesses